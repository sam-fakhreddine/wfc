<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DATUM Data Flow</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&family=Fira+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #1E40AF;
    --secondary: #3B82F6;
    --cta: #F59E0B;
    --bg: #F8FAFC;
    --text: #1E3A8A;
    --border: #DBEAFE;
    --card-bg: #FFFFFF;
    --card-shadow: rgba(30, 64, 175, 0.08);
    --grid-color: rgba(30, 58, 90, 0.06);
    --subtitle-color: #64748B;
    --controls-bg: rgba(255, 255, 255, 0.95);
    --controls-border: #DBEAFE;
    --controls-hover: #EFF6FF;
    --controls-text: #1E40AF;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --primary: #3B82F6;
      --secondary: #60A5FA;
      --cta: #F59E0B;
      --bg: #0F172A;
      --text: #DBEAFE;
      --border: #1E3A5A;
      --card-bg: #1E293B;
      --card-shadow: rgba(0, 0, 0, 0.3);
      --grid-color: rgba(59, 130, 246, 0.07);
      --subtitle-color: #94A3B8;
      --controls-bg: rgba(30, 41, 59, 0.95);
      --controls-border: #334155;
      --controls-hover: #334155;
      --controls-text: #93C5FD;
    }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(24px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-delay: 0ms !important;
      transition-duration: 0.01ms !important;
    }
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Fira Sans', sans-serif;
    background-color: var(--bg);
    color: var(--text);
    min-height: 100vh;
    background-image:
      linear-gradient(var(--grid-color) 1px, transparent 1px),
      linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
    background-size: 40px 40px;
    padding: 2rem;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
  }

  header {
    text-align: center;
    margin-bottom: 2rem;
    animation: fadeUp 0.6s ease-out both;
  }

  header h1 {
    font-family: 'Fira Code', monospace;
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 0.5rem;
    letter-spacing: -0.02em;
  }

  header p {
    font-size: 1rem;
    color: var(--subtitle-color);
  }

  .diagram-wrapper {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 8px var(--card-shadow);
    position: relative;
    overflow: hidden;
    animation: fadeUp 0.6s ease-out 0.15s both;
  }

  .zoom-controls {
    position: absolute;
    top: 1rem;
    right: 1rem;
    display: flex;
    gap: 0.25rem;
    z-index: 10;
    animation: fadeUp 0.6s ease-out 0.3s both;
  }

  .zoom-btn {
    width: 36px;
    height: 36px;
    border: 1px solid var(--controls-border);
    background: var(--controls-bg);
    color: var(--controls-text);
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Fira Code', monospace;
    font-size: 1rem;
    font-weight: 600;
    transition: background 0.15s ease;
  }

  .zoom-btn:hover {
    background: var(--controls-hover);
  }

  .zoom-btn.reset {
    font-size: 0.65rem;
    width: auto;
    padding: 0 10px;
  }

  .mermaid-container {
    overflow: auto;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 500px;
  }

  .mermaid-container .mermaid {
    transition: transform 0.2s ease;
    transform-origin: top center;
  }

  .mermaid svg {
    max-width: none !important;
  }

  .data-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
    margin-top: 1.5rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border);
    animation: fadeUp 0.6s ease-out 0.45s both;
  }

  .data-legend-item {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-family: 'Fira Code', monospace;
    font-size: 0.72rem;
    color: var(--subtitle-color);
  }

  .data-legend-line {
    width: 20px;
    height: 3px;
    border-radius: 2px;
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>DATUM Data Flow</h1>
    <p>Data movement across the platform from external sources to consumers</p>
  </header>

  <div class="diagram-wrapper">
    <div class="zoom-controls">
      <button class="zoom-btn" onclick="zoom(0.1)" title="Zoom In">+</button>
      <button class="zoom-btn" onclick="zoom(-0.1)" title="Zoom Out">&minus;</button>
      <button class="zoom-btn reset" onclick="resetZoom()" title="Reset Zoom">Reset</button>
    </div>
    <div class="mermaid-container" id="mermaid-container">
      <pre class="mermaid" id="mermaid-diagram">
graph LR
    subgraph Sources["External Sources"]
        S1["APIs"]
        S2["Databases"]
        S3["Files"]
        S4["Streams"]
    end

    subgraph Connectors["Connectors"]
        C1["API Connector"]
        C2["DB Connector"]
        C3["File Connector"]
        C4["Stream Connector"]
    end

    subgraph Raw["Staging Area"]
        R1["Raw Zone<br/><i>JSON / CSV / Avro</i>"]
    end

    subgraph Transform["Transformation Engine"]
        T1["Clean"]
        T2["Normalize"]
        T3["Enrich"]
    end

    subgraph Curated["Curated Zone"]
        CU1["Validated Datasets<br/><i>Parquet / Iceberg</i>"]
    end

    subgraph Serving["Serving Layer"]
        SV1["Materialized Views<br/><i>Columnar / Cache</i>"]
    end

    subgraph Consumers["Consumers"]
        CO1["BI Tools"]
        CO2["ML Pipelines"]
        CO3["Applications"]
        CO4["External APIs"]
    end

    subgraph CrossCutting["Cross-Cutting Concerns"]
        SR["Schema<br/>Registry"]
        MC["Metadata<br/>Catalog"]
        LT["Lineage<br/>Tracker"]
        QM["Quality<br/>Monitor"]
    end

    S1 -->|"REST/JSON"| C1
    S2 -->|"CDC/Binlog"| C2
    S3 -->|"S3/SFTP"| C3
    S4 -->|"Kafka/Kinesis"| C4

    C1 -->|"raw JSON"| R1
    C2 -->|"raw events"| R1
    C3 -->|"raw files"| R1
    C4 -->|"raw stream"| R1

    R1 -->|"staged data"| T1
    T1 -->|"cleaned"| T2
    T2 -->|"normalized"| T3
    T3 -->|"enriched Parquet"| CU1

    CU1 -->|"curated data"| SV1

    SV1 -->|"SQL/JDBC"| CO1
    SV1 -->|"DataFrame"| CO2
    SV1 -->|"REST API"| CO3
    SV1 -->|"gRPC"| CO4

    SR -.->|"validate schema"| C1
    SR -.->|"validate schema"| C2
    SR -.->|"validate schema"| C3
    SR -.->|"validate schema"| C4
    SR -.->|"enforce types"| T1

    MC -.->|"register datasets"| CU1
    MC -.->|"register views"| SV1

    LT -.->|"track"| R1
    LT -.->|"track"| T1
    LT -.->|"track"| CU1
    LT -.->|"track"| SV1

    QM -.->|"check quality"| R1
    QM -.->|"check quality"| CU1

    style Sources fill:#1E40AF,stroke:#3B82F6,color:#FFFFFF
    style Connectors fill:#DBEAFE,stroke:#3B82F6,color:#1E3A8A
    style Raw fill:#FEF3C7,stroke:#F59E0B,color:#92400E
    style Transform fill:#DBEAFE,stroke:#8B5CF6,color:#1E3A8A
    style Curated fill:#D1FAE5,stroke:#10B981,color:#065F46
    style Serving fill:#E0E7FF,stroke:#6366F1,color:#3730A3
    style Consumers fill:#1E40AF,stroke:#3B82F6,color:#FFFFFF
    style CrossCutting fill:#FEE2E2,stroke:#EF4444,color:#991B1B

    style S1 fill:#1E40AF,stroke:#3B82F6,color:#FFFFFF
    style S2 fill:#1E40AF,stroke:#3B82F6,color:#FFFFFF
    style S3 fill:#1E40AF,stroke:#3B82F6,color:#FFFFFF
    style S4 fill:#1E40AF,stroke:#3B82F6,color:#FFFFFF

    style CO1 fill:#1E40AF,stroke:#3B82F6,color:#FFFFFF
    style CO2 fill:#1E40AF,stroke:#3B82F6,color:#FFFFFF
    style CO3 fill:#1E40AF,stroke:#3B82F6,color:#FFFFFF
    style CO4 fill:#1E40AF,stroke:#3B82F6,color:#FFFFFF

    style SR fill:#FEE2E2,stroke:#EF4444,color:#991B1B
    style MC fill:#FEE2E2,stroke:#EF4444,color:#991B1B
    style LT fill:#FEE2E2,stroke:#EF4444,color:#991B1B
    style QM fill:#FEE2E2,stroke:#EF4444,color:#991B1B
      </pre>
    </div>
  </div>

  <div class="data-legend">
    <div class="data-legend-item">
      <div class="data-legend-line" style="background: #3B82F6;"></div>
      Data Flow
    </div>
    <div class="data-legend-item">
      <div class="data-legend-line" style="background: #EF4444; border: 1px dashed #EF4444; background: repeating-linear-gradient(90deg, #EF4444 0px, #EF4444 4px, transparent 4px, transparent 8px);"></div>
      Control / Metadata
    </div>
    <div class="data-legend-item">
      <div class="data-legend-line" style="background: #1E40AF;"></div>
      External Boundary
    </div>
    <div class="data-legend-item">
      <div class="data-legend-line" style="background: #10B981;"></div>
      Curated / Validated
    </div>
    <div class="data-legend-item">
      <div class="data-legend-line" style="background: #F59E0B;"></div>
      Staging / Raw
    </div>
  </div>
</div>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

  const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

  mermaid.initialize({
    startOnLoad: true,
    securityLevel: 'loose',
    theme: 'base',
    themeVariables: isDark ? {
      primaryColor: '#1E3A5A',
      primaryTextColor: '#DBEAFE',
      primaryBorderColor: '#3B82F6',
      secondaryColor: '#1E293B',
      secondaryTextColor: '#DBEAFE',
      lineColor: '#60A5FA',
      textColor: '#DBEAFE',
      fontSize: '13px',
      fontFamily: 'Fira Sans, sans-serif',
      clusterBkg: '#1E293B',
      clusterBorder: '#334155',
      edgeLabelBackground: '#0F172A'
    } : {
      primaryColor: '#DBEAFE',
      primaryTextColor: '#1E3A8A',
      primaryBorderColor: '#3B82F6',
      secondaryColor: '#EFF6FF',
      secondaryTextColor: '#1E3A8A',
      lineColor: '#3B82F6',
      textColor: '#1E3A8A',
      fontSize: '13px',
      fontFamily: 'Fira Sans, sans-serif',
      clusterBkg: '#F8FAFC',
      clusterBorder: '#DBEAFE',
      edgeLabelBackground: '#F8FAFC'
    }
  });
</script>

<script>
  let currentZoom = 1;
  const diagram = document.getElementById('mermaid-diagram');

  function zoom(delta) {
    currentZoom = Math.max(0.3, Math.min(3, currentZoom + delta));
    diagram.style.transform = 'scale(' + currentZoom + ')';
  }

  function resetZoom() {
    currentZoom = 1;
    diagram.style.transform = 'scale(1)';
  }
</script>
</body>
</html>