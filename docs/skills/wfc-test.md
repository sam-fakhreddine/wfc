# wfc-test

## What It Does

Generates a comprehensive test suite from the formal properties defined in your `PROPERTIES.md` and the acceptance criteria in your `TASKS.md`. It translates SAFETY, LIVENESS, INVARIANT, and PERFORMANCE properties into concrete property-based test cases, runs the suite, and produces a coverage gap report identifying which properties remain untested. Tests follow the RED-GREEN-REFACTOR TDD cycle used by `/wfc-implement`.

## When to Use It

- After `/wfc-plan` has produced `PROPERTIES.md` with formal properties
- When implementing a new feature with TDD and you want tests generated from requirements
- When improving test coverage on an existing module that has defined properties
- When you want to verify that SAFETY guarantees hold under adversarial inputs
- As a quality gate before submitting a task for consensus review

## Usage

```bash
/wfc-test [options]
```

## Example

```bash
/wfc-test
```

Generated test excerpt (`tests/test_rate_limiter_properties.py`):

```python
# Auto-generated by wfc-test from PROPERTIES.md
# SAFETY: PROP-001 — Rate limiter must never allow more than 100 req/min per user

import hypothesis
from hypothesis import given, settings
from hypothesis import strategies as st

@given(
    user_id=st.text(min_size=1, max_size=64),
    request_count=st.integers(min_value=101, max_value=1000),
)
@settings(max_examples=200)
def test_prop_001_rate_limit_never_exceeded(user_id, request_count):
    """SAFETY: No user exceeds 100 req/min regardless of burst pattern."""
    limiter = RateLimiter(limit=100, window_seconds=60)
    allowed = sum(limiter.check(user_id) for _ in range(request_count))
    assert allowed <= 100, f"Allowed {allowed} requests, expected <= 100"
```

Coverage report excerpt (`COVERAGE-REPORT.md`):

```
PROP-001 (SAFETY)       ✅ 3 tests generated, 3 passing
PROP-002 (LIVENESS)     ✅ 2 tests generated, 2 passing
PROP-003 (PERFORMANCE)  ⚠️  No tests generated — missing benchmark harness
PROP-004 (INVARIANT)    ✅ 4 tests generated, 4 passing

Coverage: 9/10 properties tested. Gap: PROP-003 requires manual benchmark setup.
```

## Options

| Flag | Description |
|------|-------------|
| (none) | Generate tests from PROPERTIES.md and TASKS.md, then run them |
| `--generate` | Generate test files only (do not execute) |
| `--run` | Execute existing generated tests only (skip generation) |

## Integration

**Produces:**

- `tests/` directory — Generated test files, one per property category
- `COVERAGE-REPORT.md` — Which properties are tested, which have gaps, pass/fail summary

**Consumes:**

- `PROPERTIES.md` — Formal SAFETY, LIVENESS, INVARIANT, and PERFORMANCE properties (primary source)
- `TASKS.md` — Acceptance criteria used for requirement-based test generation

**Next step:** Feed coverage gaps back into `/wfc-implement` for missing test implementation, or run `/wfc-observe` to convert PERFORMANCE properties into runtime metrics and alerts.
