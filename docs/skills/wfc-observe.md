# wfc-observe

## What It Does

Derives production observability infrastructure directly from the formal properties in your `PROPERTIES.md`. It maps each SAFETY, LIVENESS, INVARIANT, and PERFORMANCE property to concrete metrics, alert rules, and dashboard panels — so your monitoring reflects the system's actual correctness guarantees rather than ad-hoc dashboards. The output is ready-to-deploy collector code, alert rule definitions, and dashboard JSON.

## When to Use It

- After `/wfc-implement` when preparing a feature for production deployment
- When adding monitoring to a module that already has formal properties defined
- When existing dashboards do not reflect the system's correctness guarantees
- As part of a production-readiness checklist or SRE review
- When you want alert thresholds grounded in formal specifications, not intuition

## Usage

```bash
/wfc-observe [options]
```

## Example

```bash
/wfc-observe
```

Generated alert rule excerpt (`alerts/prop-001-rate-limit.yml`):

```yaml
# Auto-generated by wfc-observe from PROPERTIES.md
# SAFETY: PROP-001 — Rate limiter never allows > 100 req/min per user

groups:
  - name: rate_limiter_safety
    rules:
      - alert: RateLimitSafetyViolation
        expr: rate(http_requests_allowed_total[1m]) > 100
        for: 0m
        labels:
          severity: critical
          property: PROP-001
        annotations:
          summary: "SAFETY violation: request rate exceeded guaranteed limit"
          description: "User {{ $labels.user_id }} allowed {{ $value }} req/min (limit: 100)"
```

OBSERVABILITY.md excerpt:

```markdown
## Property Mapping

| Property | Type | Observable | Metric | Alert Threshold |
|----------|------|------------|--------|-----------------|
| PROP-001 | SAFETY | Allowed request count per user per minute | `http_requests_allowed_total` | > 100 req/min |
| PROP-002 | LIVENESS | Health check response time | `health_check_duration_seconds` | p99 > 500ms |
| PROP-003 | PERFORMANCE | API latency | `http_request_duration_seconds` | p95 > 200ms |
| PROP-004 | INVARIANT | Queue depth | `queue_depth_gauge` | > 10,000 items |
```

## Options

| Flag | Description |
|------|-------------|
| (none) | Generate all observability artifacts from all properties in PROPERTIES.md |
| `--properties PROP-001,PROP-002` | Generate artifacts for specific property IDs only |

**Property-to-observable mapping rules:**

- `SAFETY` properties map to error counts, assertion failures, security violation counters
- `LIVENESS` properties map to health checks, response times, timeout counters
- `INVARIANT` properties map to data integrity checks, state validation gauges
- `PERFORMANCE` properties map to latency percentiles, throughput rates, resource utilization

## Integration

**Produces:**

- `OBSERVABILITY.md` — Property-to-metric mapping table and deployment guide
- `metrics/` — Collector code for each mapped metric
- `alerts/` — Alert rule definitions (Prometheus/Alertmanager format)
- `dashboards/` — Dashboard panel configuration JSON

**Consumes:**

- `PROPERTIES.md` — SAFETY, LIVENESS, INVARIANT, and PERFORMANCE properties (required)

**Next step:** Deploy the generated collectors and alert rules alongside the feature. Use `/wfc-security` if you want threat-derived alert rules in addition to property-derived ones.
