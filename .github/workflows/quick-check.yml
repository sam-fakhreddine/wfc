name: Quick Check

# Fast validation workflow - runs on every push
# Optimized for speed: ~30 seconds vs full CI ~3-5 minutes

on:
  push:
    branches: ["*"]
  pull_request:
    branches: [main]

jobs:
  quick-check:
    name: Fast Validation
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install UV
        run: |
          curl -LsSf https://astral.sh/uv/install.sh | sh
          echo "$HOME/.cargo/bin" >> $GITHUB_PATH

      - name: Install dependencies (minimal)
        run: |
          uv pip install --system -e ".[dev]"

      - name: Install WFC skills
        run: |
          mkdir -p ~/.claude/skills
          chmod +x install.sh
          ./install.sh <<< 'y'

      - name: Format check (black)
        run: |
          black --check --diff wfc/
        continue-on-error: false

      - name: Lint (ruff)
        run: |
          ruff check wfc/
        continue-on-error: false

      - name: Quick smoke tests (fast tests only)
        run: |
          # Run only fast unit tests (skip integration/e2e)
          pytest tests/ -m "not slow and not e2e" -v --tb=short || true
        continue-on-error: true

      - name: Check imports
        run: |
          python -c "
          import sys
          sys.path.insert(0, '.')

          # Quick import check of critical modules
          from wfc.scripts.confidence_checker import ConfidenceChecker
          from wfc.scripts.memory_manager import MemoryManager
          from wfc.scripts.token_manager import TokenManager
          from wfc.scripts.universal_quality_checker import UniversalQualityChecker

          print('âœ… All critical imports successful')
          "

      - name: Summary
        if: always()
        run: |
          echo "=========================================="
          echo "Quick Check Complete"
          echo "=========================================="
          echo "Format: ${{ steps.format-check.outcome }}"
          echo "Lint: ${{ steps.lint.outcome }}"
          echo "=========================================="
