<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WFC Data Explorer</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0f172a; --surface: #1e293b; --border: #334155;
    --text: #e2e8f0; --dim: #94a3b8; --accent: #3b82f6;
    --accent-hover: #2563eb;
    --tree-key: #f472b6; --tree-string: #38bdf8;
    --tree-number: #fbbf24; --tree-bool: #4ade80; --tree-null: #64748b;
    --font-body: 'Space Grotesk', system-ui, sans-serif;
    --font-mono: 'JetBrains Mono', 'SF Mono', Consolas, monospace;
  }

  @media (prefers-color-scheme: light) {
    :root {
      --bg: #f1f5f9; --surface: #ffffff; --border: #e2e8f0;
      --text: #1e293b; --dim: #64748b; --accent: #2563eb;
      --accent-hover: #1d4ed8;
      --tree-key: #be185d; --tree-string: #0369a1;
      --tree-number: #b45309; --tree-bool: #15803d; --tree-null: #94a3b8;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      transition-duration: 0.01ms !important;
    }
  }

  body {
    font-family: var(--font-body);
    background: var(--bg); color: var(--text); height: 100vh;
    display: grid; grid-template-columns: 1fr 1fr;
    grid-template-rows: auto 1fr;
  }
  .toolbar {
    grid-column: 1 / 3; background: var(--surface); padding: 12px 20px;
    display: flex; align-items: center; gap: 12px;
    border-bottom: 1px solid var(--border);
  }
  .toolbar h2 { color: var(--accent); font-size: 16px; margin-right: 12px; font-weight: 600; }
  .toolbar input[type="text"] {
    flex: 1; padding: 8px 14px; background: var(--bg); border: 1px solid var(--border);
    border-radius: 6px; color: var(--text); font-size: 13px; font-family: var(--font-body);
  }
  .toolbar input::placeholder { color: var(--dim); }
  .toolbar button {
    padding: 8px 16px; background: var(--accent); color: #fff; border: none;
    border-radius: 6px; cursor: pointer; font-size: 12px; white-space: nowrap;
    font-family: var(--font-mono); transition: background 0.15s;
  }
  .toolbar button:hover { background: var(--accent-hover); }
  .input-panel {
    padding: 16px; border-right: 1px solid var(--border);
    display: flex; flex-direction: column;
  }
  .input-panel label {
    font-size: 10px; color: var(--dim); text-transform: uppercase;
    letter-spacing: 1.2px; margin-bottom: 8px; font-family: var(--font-mono); font-weight: 600;
  }
  .input-panel textarea {
    flex: 1; padding: 14px; background: var(--bg); border: 1px solid var(--border);
    border-radius: 8px; color: var(--tree-string); font-family: var(--font-mono);
    font-size: 13px; resize: none; line-height: 1.5;
  }
  .input-panel .actions { margin-top: 10px; display: flex; gap: 8px; }
  .input-panel .actions button {
    padding: 6px 14px; background: var(--surface); color: var(--text); border: 1px solid var(--border);
    border-radius: 6px; cursor: pointer; font-size: 11px; font-family: var(--font-mono);
    transition: background 0.15s;
  }
  .input-panel .actions button:hover { background: var(--border); }
  .output-panel { padding: 16px; overflow: auto; }
  .output-panel label {
    font-size: 10px; color: var(--dim); text-transform: uppercase;
    letter-spacing: 1.2px; margin-bottom: 8px; display: block;
    font-family: var(--font-mono); font-weight: 600;
  }
  .tree { font-family: var(--font-mono); font-size: 13px; }
  .tree-node { padding: 2px 0; }
  .tree-key { color: var(--tree-key); }
  .tree-string { color: var(--tree-string); }
  .tree-number { color: var(--tree-number); }
  .tree-bool { color: var(--tree-bool); }
  .tree-null { color: var(--tree-null); font-style: italic; }
  .tree-toggle {
    cursor: pointer; user-select: none; display: inline-block;
    width: 16px; color: var(--dim);
  }
  .tree-toggle:hover { color: var(--accent); }
  .tree-children { margin-left: 20px; }
  .tree-children.collapsed { display: none; }
  .error-msg { color: #f87171; padding: 20px; font-size: 14px; }
  .stats {
    margin-top: 10px; font-size: 11px; color: var(--dim);
    border-top: 1px solid var(--border); padding-top: 8px;
    font-family: var(--font-mono);
  }
  .highlight { background: rgba(59, 130, 246, 0.15); border-radius: 2px; }

  @media (max-width: 768px) {
    body { grid-template-columns: 1fr; }
    .input-panel { border-right: none; border-bottom: 1px solid var(--border); max-height: 40vh; }
  }
</style>
</head>
<body>

<div class="toolbar">
  <h2>Data Explorer</h2>
  <input type="text" id="searchInput" placeholder="Search keys or values...">
  <button onclick="copyFormatted(event)">Copy Formatted</button>
</div>

<div class="input-panel">
  <label>JSON Input</label>
  <textarea id="jsonInput" placeholder="Paste JSON here...">{
  "name": "WFC",
  "version": "2.0.0",
  "features": [
    {"name": "review", "agents": 5, "active": true},
    {"name": "plan", "agents": 1, "active": true},
    {"name": "implement", "agents": 8, "active": false}
  ],
  "config": {
    "token_budget": 150000,
    "reduction": "99%",
    "personas": 54
  }
}</textarea>
  <div class="actions">
    <button onclick="parseJSON()">Parse</button>
    <button onclick="formatInput()">Format</button>
    <button onclick="minifyInput()">Minify</button>
    <button onclick="clearAll()">Clear</button>
  </div>
</div>

<div class="output-panel">
  <label>Tree View</label>
  <div id="treeView"></div>
  <div class="stats" id="stats"></div>
</div>

<script>
  const jsonInput = document.getElementById('jsonInput');
  const treeView = document.getElementById('treeView');
  const stats = document.getElementById('stats');
  const searchInput = document.getElementById('searchInput');

  function parseJSON() {
    try {
      const data = JSON.parse(jsonInput.value);
      treeView.innerHTML = '';
      treeView.appendChild(buildTree(data, ''));
      updateStats(data);
    } catch (e) {
      treeView.innerHTML = `<div class="error-msg">Parse Error: ${e.message}</div>`;
      stats.textContent = '';
    }
  }

  function buildTree(data, path) {
    const container = document.createElement('div');
    if (data === null) {
      container.innerHTML = '<span class="tree-null">null</span>';
      return container;
    }
    if (typeof data !== 'object') {
      const cls = typeof data === 'string' ? 'tree-string'
        : typeof data === 'number' ? 'tree-number'
        : typeof data === 'boolean' ? 'tree-bool' : '';
      const val = typeof data === 'string' ? `"${data}"` : String(data);
      container.innerHTML = `<span class="${cls}">${val}</span>`;
      return container;
    }
    const isArr = Array.isArray(data);
    const entries = isArr
      ? data.map((v, i) => [i, v])
      : Object.entries(data);

    entries.forEach(([key, val]) => {
      const node = document.createElement('div');
      node.className = 'tree-node';
      const childPath = path ? `${path}.${key}` : String(key);

      if (val !== null && typeof val === 'object') {
        const toggle = document.createElement('span');
        toggle.className = 'tree-toggle';
        toggle.textContent = '\u25BC';
        const children = document.createElement('div');
        children.className = 'tree-children';
        children.appendChild(buildTree(val, childPath));

        toggle.addEventListener('click', () => {
          const collapsed = children.classList.toggle('collapsed');
          toggle.textContent = collapsed ? '\u25B6' : '\u25BC';
        });

        const bracket = Array.isArray(val)
          ? `[${val.length}]` : `{${Object.keys(val).length}}`;
        node.appendChild(toggle);
        node.insertAdjacentHTML('beforeend',
          `<span class="tree-key">${key}</span>: ${bracket}`);
        node.appendChild(children);
      } else {
        node.insertAdjacentHTML('beforeend',
          '<span class="tree-toggle"> </span>');
        node.insertAdjacentHTML('beforeend',
          `<span class="tree-key">${key}</span>: `);
        node.appendChild(buildTree(val, childPath));
      }
      container.appendChild(node);
    });
    return container;
  }

  function updateStats(data) {
    const count = (obj) => {
      if (obj === null || typeof obj !== 'object') return 1;
      const entries = Array.isArray(obj) ? obj : Object.values(obj);
      return entries.reduce((s, v) => s + count(v), 0);
    };
    const keys = (obj) => {
      if (obj === null || typeof obj !== 'object') return 0;
      const e = Object.keys(obj).length;
      return e + Object.values(obj).reduce((s, v) => s + keys(v), 0);
    };
    const depth = (obj) => {
      if (obj === null || typeof obj !== 'object') return 0;
      const vals = Array.isArray(obj) ? obj : Object.values(obj);
      return 1 + (vals.length ? Math.max(...vals.map(depth)) : 0);
    };
    stats.textContent =
      `Values: ${count(data)} | Keys: ${keys(data)} | Max depth: ${depth(data)} | ` +
      `Size: ${new Blob([jsonInput.value]).size} bytes`;
  }

  function formatInput() {
    try {
      const data = JSON.parse(jsonInput.value);
      jsonInput.value = JSON.stringify(data, null, 2);
    } catch (_) {}
  }

  function minifyInput() {
    try {
      const data = JSON.parse(jsonInput.value);
      jsonInput.value = JSON.stringify(data);
    } catch (_) {}
  }

  function clearAll() {
    jsonInput.value = '';
    treeView.innerHTML = '';
    stats.textContent = '';
  }

  function copyFormatted(e) {
    try {
      const data = JSON.parse(jsonInput.value);
      const text = JSON.stringify(data, null, 2);
      navigator.clipboard.writeText(text).then(() => {
        const btn = e.currentTarget;
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = 'Copy Formatted', 1500);
      });
    } catch (_) {}
  }

  searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase();
    document.querySelectorAll('.tree-node').forEach(node => {
      if (!query) { node.classList.remove('highlight'); return; }
      const text = node.textContent.toLowerCase();
      node.classList.toggle('highlight', text.includes(query));
    });
  });

  parseJSON();
</script>
</body>
</html>
